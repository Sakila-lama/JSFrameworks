<div class="container mt-5">
  <h2 class="mb-4">I would like to book an appointment for</h2>
  <div class="form-group">
    <select class="form-control" id="appointmentFor">
      <option value="just-me">Just Me</option>
      <option value="someone-else">Someone Else</option>
    </select>
  </div>

  <div class="d-flex justify-content-between align-items-center">
    <h3 class="my-4">SELECT A SERVICE</h3>
    <select class="form-control ml-3" id="service-select">
      <option value="fhf-hydration-cascade" {{#ifEquals treatment "fhf-hydration-cascade"}}selected{{/ifEquals}}>FHF Hydration Cascade Facial</option>
      <option value="fhf-mighty-tighty" {{#ifEquals treatment "fhf-mighty-tighty"}}selected{{/ifEquals}}>FHF Mighty Tighty Facial</option>
      <option value="fhf-porefectly-calm" {{#ifEquals treatment "fhf-porefectly-calm"}}selected{{/ifEquals}}>FHF Porefectly Calm Facial</option>
      <option value="fhf-purely-degunked" {{#ifEquals treatment "fhf-purely-degunked"}}selected{{/ifEquals}}>FHF Purely Degunked Facial</option>
      <option value="fhf-radiance-maker" {{#ifEquals treatment "fhf-radiance-maker"}}selected{{/ifEquals}}>FHF Radiance Maker Facial</option>
      <option value="glo-calm" {{#ifEquals treatment "glo-calm"}}selected{{/ifEquals}}>Glo Calm Facial</option>
      <option value="glo-clear" {{#ifEquals treatment "glo-clear"}}selected{{/ifEquals}}>Glo Clear Facial</option>
      <option value="glo-firm" {{#ifEquals treatment "glo-firm"}}selected{{/ifEquals}}>Glo Firm Facial</option>
      <option value="glo-signature" {{#ifEquals treatment "glo-signature"}}selected{{/ifEquals}}>Glo Signature Facial</option>
      <option value="pregnancy" {{#ifEquals treatment "pregnancy"}}selected{{/ifEquals}}>Pregnancy Facial</option>
      <option value="flower-enzyme" {{#ifEquals treatment "flower-enzyme"}}selected{{/ifEquals}}>Flower Enzyme Chemical Peel</option>
      <option value="glypro-aha" {{#ifEquals treatment "glypro-aha"}}selected{{/ifEquals}}>Glypro AHA Resurfacing Chemical Peel</option>
      <option value="hydra-bright-aha" {{#ifEquals treatment "hydra-bright-aha"}}selected{{/ifEquals}}>Hydra-Bright AHA Glow Peel</option>
    </select>
  </div>

  <div class="selected-service mb-4 p-3 border">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <strong>{{treatmentName}}</strong>
        <br />
        <span>{{treatmentPrice}}</span>
        <br />
        <span>{{treatmentDuration}}</span>
      </div>
      <select class="form-control ml-3">
        <option value="service-provider-1">Emily</option>
        <option value="service-provider-2">Sophia</option>
        <option value="service-provider-3">Isabella</option>
        <option value="service-provider-4">Mia</option>
        <option value="service-provider-5">Olivia</option>
        <option value="service-provider-6">Ava</option>
      </select>
    </div>
  </div>
  <button type="button" class="btn btn-dark mb-4">+ Add Another Service</button>

  <h3 class="my-4">SELECT DATE AND TIME</h3>
  <div class="d-flex justify-content-between">
    <div>
      <div id="calendar" class="calendar-container">
        <!-- Calendar will be rendered here by FullCalendar -->
      </div>
    </div>
    <div class="available-slots-container border p-3">
      <h5>Available slots for Thu, Aug 08 2024</h5>
      <p class="text-danger">We're sorry, our appointment book is currently full. Please choose a different date or service.</p>
      <button type="button" class="btn btn-dark">Join Waitlist for Thu, Aug 08 2024 ➔</button>
    </div>
  </div>
</div>

<!-- Initialize FullCalendar -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      dateClick: function(info) {
        // When a date is clicked, update the selected date and available slots
        document.getElementById('selected-date').textContent = info.dateStr;
        document.getElementById('waitlist-date').textContent = info.dateStr;
        // Fetch real available slots for the selected date
        fetchSlots(info.dateStr);
      }
    });
    calendar.render();
  });

  // Function to fetch available slots from the server
  function fetchSlots(dateStr) {
    fetch(`/available-slots?date=${dateStr}`)
      .then(response => response.json())
      .then(data => {
        const slots = data.slots.join(', ');
        const slotsContainer = document.querySelector('.available-slots-container');
        if (slots.length > 0) {
          slotsContainer.innerHTML = `
            <h5>Available slots for ${dateStr}</h5>
            <p class="text-success">${slots}</p>
            <button type="button" class="btn btn-dark">Book Slot for ${dateStr} ➔</button>
          `;
        } else {
          slotsContainer.innerHTML = `
            <h5>Available slots for ${dateStr}</h5>
            <p class="text-danger">We're sorry, our appointment book is currently full. Please choose a different date or service.</p>
            <button type="button" class="btn btn-dark">Join Waitlist for ${dateStr} ➔</button>
          `;
        }
      })
      .catch(error => console.error('Error fetching slots:', error));
  }
</script>
